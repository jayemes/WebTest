<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="numeric-1.2.6.js"></script>
    <style>
    p {
        margin: 0;
    }
    
    *:not(head):not(script) {
        box-sizing: border-box;
        display: block;
    }
    
    @media (orientation: portrait) {
        outer1 {
            width: 100%;
            height: 18%;
        }
        outer2 {
            width: 100%;
            height: 82%;
        }
        inner1 {
            width: 33%;
            height: 100%;
        }
        inner2 {
            width: 33%;
            height: 100%;
        }
        inner3 {
            width: 33%;
            height: 100%;
        }
    }
    
    @media (orientation: landscape) {
        outer1 {
            width: 21%;
            height: 100%;
            float: left;
        }
        outer2 {
            height: 100%;
            width: 79%;
            float: left;
        }
        inner1 {
            width: 100%;
            height: 33%;
        }
        inner2 {
            width: 100%;
            height: 33%;
        }
        inner3 {
            width: 100%;
            height: 33%;
        }
    }
    
    input {
        width: 70px;
    }
    
    @media (orientation: portrait) {
        inners {
            width: 33%;
            height: 100%;
            float: left;
        }
    }
    
    @media (orientation: landscape) {
        inners {
            width: 100%;
            height: 33%;
        }
    }
    </style>
</head>

<body style="margin:0;width:99vw;height:99vh;">
    <outer1 style="background-color: darkolivegreen;">
        <inners style="min-width:160px;">
            <div style="font-size:6vmax;margin-left:5px">A:</div>
            <div id=matrix style="width:150px;height:10%;margin-top:10px;margin-bottom:5%;margin-left:5px">
                <div id=mrow1 style="height:50%">
                    <input type="number" id="a0" style="float:left;">
                    <input type="number" id="a1" style="float:right;">
                </div>
                <br>
                <div id=mrow2 style="height:50%">
                    <input type="number" id="a2" style="float:left;">
                    <input type="number" id="a3" style="float:right;">
                </div>
            </div>
        </inners>
        <inners style="background-color: rgb(104, 145, 91)">
            <div style="font-size:6vmax;margin-left:5px;color:rgb(255, 153, 0)">x:</div>
            <div id=vector style="width:100%;height:100%;margin-top:10px;margin-bottom:5%;margin-right:20%;margin-left:5px;">
                <input type="number" id="a4">
                <input type="number" id="a5" style="margin-top:3%;">
            </div>
            </div>
        </inners>
        <div style="font-size:6vmax;margin-left:10px;float:left;color:rgb(127, 255, 35)">y:
            <br>
            <div id="theVector" style="font-size:4vmax;color:black">1
                <br>2</div>
        </div>
    </outer1>
    <outer2>
        <div id="GraphCont1" style="width:100%;height:50%;"></div>
        <div id="GraphCont2" style="width:100%;height:50%;"></div>
    </outer2>
    <script>
    var gendatafortransf = function() {
        transfPoints = numeric.dot(Matrix, [xVal, yVal]);
        transfVector = numeric.dot(Matrix, Vector);
        xPos = transfVector[0] > 0;
        xZero = transfVector[0] == 0;
        yPos = transfVector[1] > 0;
        yZero = transfVector[1] == 0;
        if (xPos) {
            if (yPos) {
                theSymbol = 'triangle-ne';
            } else {
                if (yZero) {
                    theSymbol = 'triangle-right';
                } else {
                    theSymbol = 'triangle-se';
                }
            }
        } else {
            if (xZero) {
                if (yPos) {
                    theSymbol = 'triangle-up';
                } else {
                    if (yZero) {
                        theSymbol = 'circle';
                    } else {
                        theSymbol = 'triangle-down';
                    }
                }
            } else {
                if (yPos) {
                    theSymbol = 'triangle-nw';
                } else {
                    if (yZero) {
                        theSymbol = 'triangle-left';
                    } else {
                        theSymbol = 'triangle-sw';
                    }
                }
            }
        }
        data = [{
            x: transfPoints[0],
            y: transfPoints[1],
            mode: 'lines',
            name: 'Todos los vectores transformados',
            line: {
                color: 'red'
            }
        }, {
            x: [0, transfVector[0]],
            y: [0, transfVector[1]],
            name: "Vector y",
            mode: 'lines',
            line: {
                color: 'rgb(127, 255, 35)'
            },
        }, {
            x: [transfVector[0]],
            y: [transfVector[1]],
            marker: {
                color: 'rgb(127, 255, 35)',
                symbol: theSymbol,
                size: 8
            },
            showlegend: false
        }];
        document.getElementById("theVector").innerHTML = transfVector[0] + "<br>" + transfVector[1];
        return data;
    }

    var gendataforvector = function() {
        vectorNorm = numeric.norm2(Vector);
        xVal = numeric.mul(numeric.cos(t), vectorNorm);
        yVal = numeric.mul(numeric.sin(t), vectorNorm);
        xPos = Vector[0] > 0;
        xZero = Vector[0] == 0;
        yPos = Vector[1] > 0;
        yZero = Vector[1] == 0;
        if (xPos) {
            if (yPos) {
                theSymbol = 'triangle-ne';
            } else {
                if (yZero) {
                    theSymbol = 'triangle-right';
                } else {
                    theSymbol = 'triangle-se';
                }
            }
        } else {
            if (xZero) {
                if (yPos) {
                    theSymbol = 'triangle-up';
                } else {
                    if (yZero) {
                        theSymbol = 'circle';
                    } else {
                        theSymbol = 'triangle-down';
                    }
                }
            } else {
                if (yPos) {
                    theSymbol = 'triangle-nw';
                } else {
                    if (yZero) {
                        theSymbol = 'triangle-left';
                    } else {
                        theSymbol = 'triangle-sw';
                    }
                }
            }
        }
        return [{
            x: xVal,
            y: yVal,
            mode: 'lines',
            name: 'Todos los vectores de la misma norma que x'
        }, {
            x: [0, Vector[0]],
            y: [0, Vector[1]],
            name: 'Vector x',
            mode: 'lines',
            line: {
                color: 'rgb(255, 153, 0)'
            }
        }, {
            x: [Vector[0]],
            y: [Vector[1]],
            marker: {
                color: 'rgb(255, 153, 0)',
                symbol: theSymbol,
                size: 8
            },
            showlegend: false
        }];
    }

    var recalcVector = function() {
        Vector[0] = Number(document.getElementById("a4").value);
        Vector[1] = Number(document.getElementById("a5").value);
        newData = gendataforvector();
        gd.data[0].x = newData[0].x;
        gd.data[0].y = newData[0].y;
        gd.data[1].x = newData[1].x;
        gd.data[1].y = newData[1].y;
        gd.data[2].x = newData[2].x;
        gd.data[2].y = newData[2].y;
        gd.data[2].marker.symbol = newData[2].marker.symbol;
        Plotly.redraw(gd);
        newData = gendatafortransf();
        gd2.data[0].x = newData[0].x;
        gd2.data[0].y = newData[0].y;
        gd2.data[1].x = newData[1].x;
        gd2.data[1].y = newData[1].y;
        gd2.data[2].x = newData[2].x;
        gd2.data[2].y = newData[2].y;
        gd2.data[2].marker.symbol = newData[2].marker.symbol;
        Plotly.redraw(gd2);
    }

    var recalcMatrix = function() {
        //how does performance compare between reading the whole matrix perform better than just reading what changed ? 
        Matrix[0][0] = Number(document.getElementById("a0").value);
        Matrix[0][1] = Number(document.getElementById("a1").value);
        Matrix[1][0] = Number(document.getElementById("a2").value);
        Matrix[1][1] = Number(document.getElementById("a3").value);
        newData = gendatafortransf();
        gd2.data[0].x = newData[0].x;
        gd2.data[0].y = newData[0].y;
        gd2.data[1].x = newData[1].x;
        gd2.data[1].y = newData[1].y;
        gd2.data[2].x = newData[2].x;
        gd2.data[2].y = newData[2].y;
        gd2.data[2].marker.symbol = newData[2].marker.symbol;
        Plotly.redraw(gd2);
        changeVector();
    }

    document.getElementById("a0").addEventListener('change', recalcMatrix);
    document.getElementById("a1").addEventListener('change', recalcMatrix);
    document.getElementById("a2").addEventListener('change', recalcMatrix);
    document.getElementById("a3").addEventListener('change', recalcMatrix);

    document.getElementById("a4").addEventListener('change', recalcVector);
    document.getElementById("a5").addEventListener('change', recalcVector);

    var Matrix = [
        [Math.floor((Math.random() * 20) - 10), Math.floor((Math.random() * 20) - 10)],
        [Math.floor((Math.random() * 20) - 10), Math.floor((Math.random() * 20) - 10)]
    ];
    var Vector = [Math.floor((Math.random() * 20) - 10), Math.floor((Math.random() * 20) - 10)];
    var merged = [].concat.apply([], Matrix).concat(Vector);
    for (var i = 0; i < 6; i++) {
        document.getElementById("a" + i).value = merged[i];
    }

    var d3 = Plotly.d3;
    var pariente = d3.select("#GraphCont1");
    var w = pariente[0][0].offsetWidth;
    var h = pariente[0][0].offsetHeight;
    var gd3 = pariente
        .append('div')
        .style({
            width: w + 'px',
            height: h + 'px',
        });
    var gd = gd3.node();
    pariente2 = d3.select('#GraphCont2');
    var gd32 = pariente2
        .append('div')
        .style({
            width: w + 'px',
            height: h + 'px',
        });
    var gd2 = gd32.node();

    if (w > h) {
        var layUp = {
            margin: {
                t: 20,
                b: 50,
                l: 50,
                r: (w - h - 50)
            },
            legend: {
                x: 0,
                y: 1.2
            }
        };
    } else {
        var layUp = {
            margin: {
                t: 20,
                l: 50,
                r: 50,
                b: (h - w - 50)
            },
            legend: {
                x: 0,
                y: 1.2
            }
        };
    }

    t = numeric.linspace(0, 2 * Math.PI, 100);

    Plotly.plot(gd, gendataforvector(), layUp, {
        staticPlot: true
    });
    Plotly.plot(gd2, gendatafortransf(), layUp, {
        staticPlot: true
    });

    window.onresize = function() {
        w = pariente[0][0].offsetWidth;
        h = pariente[0][0].offsetHeight;
        gd.style.width = w + "px";
        gd.style.height = h + "px";
        w = pariente2[0][0].offsetWidth;
        h = pariente2[0][0].offsetHeight;
        gd2.style.width = w + "px";
        gd2.style.height = h + "px";
        Plotly.Plots.resize(gd);
        Plotly.Plots.resize(gd2);
        if (w > h) {
            var layUp = {
                margin: {
                    t: 50,
                    b: 50,
                    l: 50,
                    r: (w - h - 50)
                }
            };
        } else {
            var layUp = {
                margin: {
                    t: 50,
                    l: 50,
                    r: 50,
                    b: (h - w - 50)
                }
            };
        }
        Plotly.relayout(gd2, layUp);
        Plotly.relayout(gd, layUp);
    }
    </script>
</body>
